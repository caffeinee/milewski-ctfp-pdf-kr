\documentclass[\OPTmodes]{book}

\usepackage{xspace}

% 용어 모음

% 꼭 \newcommand{}{} % ~~~ 꼴로 써 주셔야 합니다! 
% 짜놓은 스크립트가 이 사실을 적극적으로 이용합니다.
% 만약 "이 단어는 매크로 적용하면 안 되겠다"는 게 있다면, % 이후에 $$$$$$$$$$와 같이 써 주세요

% 다른 용어의 일부인 용어들은 되도록 뒤에 와야 합니다.
% parameter가 formal parameter 앞쪽으로 오게 되면,
% Formal \trParameter 같은 일이 생깁니다.
% (이런 경우가 자동적으로 핸들링되게끔 고칠 예정이 있습니다만, 그게 정확히 어찌 하면 좋을지가 조금 막막합니다.)

\newcommand{\trComposition}{합성\xspace} % composition
\newcommand{\trCategoryTheory}{카테고리 이론\xspace} % category theory
\newcommand{\trCategory}{카테고리\xspace} % category
\newcommand{\trSideEffect}{사이드 이펙트\xspace} % side effect
\newcommand{\trObject}{객체\xspace} % object
\newcommand{\trArrow}{화살표\xspace} % arrow
\newcommand{\trAssociativity}{결합성\xspace} %associativity
\newcommand{\trIdentityMorphism}{항등사상\xspace} % identity morphism
\newcommand{\trIdentity}{아이덴티티\xspace} % identity
\newcommand{\trMorphism}{사상\xspace} % morphism
\newcommand{\trUnit}{항등원\xspace} % unit
\newcommand{\trFunctionBody}{정의\xspace} % $$$$$$$$$$$$$$
\newcommand{\trExpression}{표현식\xspace} % expression
\newcommand{\trStatement}{문장\xspace} % statement
\newcommand{\trSymbolic}{심볼릭\xspace} % symbolic
\newcommand{\trHigherOrderFunction}{고계 함수\xspace} % higher-order function
\newcommand{\trArgument}{인자\xspace} % argument
\newcommand{\trFormalParameter}{형식 매개 변수\xspace} % formal parameter
\newcommand{\trParameter}{매개 변수\xspace} % parameter
\newcommand{\trComposability}{합성 가능성\xspace} % composability
\newcommand{\trTargetObject}{대상 개체\xspace} % target object
\newcommand{\trSourceObject}{원본 개체\xspace} % source object
\newcommand{\trTypeInference}{타입 추론\xspace} % type inference
\newcommand{\trTypeAnnotation}{타입 어노테이션\xspace} % type annotation
\newcommand{\trPolymorphic}{다형적\xspace} % polymorphic
\newcommand{\trBottom}{바텀\xspace} % bottom
\newcommand{\trSemantics}{의미론\xspace} % semantics
\newcommand{\trPartial}{파셜\xspace} % partial
\newcommand{\trTotal}{토탈\xspace} % total
\newcommand{\trOperationalSemantics}{동작 의미론\xspace} % operational semantics
\newcommand{\trDenotationalSemantics}{표기 의미론\xspace} % denotational semantics
\newcommand{\trMonad}{모나드\xspace} % monad
\newcommand{\trSourceFunction}{원본 함수\xspace} % source function
\newcommand{\trTargetFunction}{대상 함수\xspace} % target function
\newcommand{\trIsomorphism}{이소모피즘\xspace} % isomorphism
\newcommand{\trList}{리스트\xspace} % list
\newcommand{\trTarget}{대상\xspace} % target
\newcommand{\trPredicates}{술어\xspace} % predicates
\newcommand{\trAdder}{가산자\xspace} % adder
\newcommand{\trThin}{얇\xspace} % $$$$$$$$$$$$$$$$
\newcommand{\trAssociate}{결합\xspace} % assiciate
\newcommand{\trExtensional}{확장된\xspace} % extensional
\newcommand{\trPreorder}{전위순서집합\xspace} % preorder
\newcommand{\trTotalOrder}{전순서집합\xspace} % total order
\newcommand{\trPartialOrder}{부분순서집합\xspace} % partial order
\newcommand{\trLinearOrder}{선형순서집합\xspace} % linear order
\newcommand{\trOrder}{순서\xspace} % order
\newcommand{\trHomSet}{사상집합\xspace} % hom-set
\newcommand{\trNeutralElement}{중립원소\xspace} % neutral element
\newcommand{\trCommutativity}{교환성\xspace} % 
\newcommand{\trCurrying}{커링\xspace} % currying
\newcommand{\trPointFree}{점독립\xspace} % point-free
\newcommand{\trPointWiseEquality}{점별 동등성\xspace} % point-wise equality
\newcommand{\trMonoid}{모노이드\xspace} % monoid
\newcommand{\trLocallySmall}{국소적으로 작다\xspace} % locally small
\newcommand{\trFreeCategory}{자유카테고리\xspace} % free category
\newcommand{\trFreeConstruction}{자유구성\xspace} % free construction
\newcommand{\trNode}{꼭짓점\xspace} % node
\newcommand{\trEdge}{간선\xspace} % edge
%여쭈어보고 하는 게 좋을 거 같은데, 결국 모든 용어 뒤에 \xspace가 있어야 하는 게 맞나요?
%


\usepackage[papersize={\OPTpagesize},
            top=\OPTtopmargin,
            bottom=\OPTbottommargin,
            inner=\OPTinnermargin,
            outer=\OPToutermargin,
            bindingoffset=\OPTbindingoffset,
            centering,
            ]{geometry}

% New line height: 1.05 * 1.2 = 1.26
\renewcommand{\baselinestretch}{1.05}

% Font settings
%--------------------------------------------------------------%  Note:
\usepackage[no-math]{fontspec}                                 %  This exact order
\usepackage{libertine}                                         %  of declarations
\defaultfontfeatures{%                                         %  is important for
  Scale=MatchLowercase, % needed here ...                      %  single quotes not
}                                                              %  to turn out curly
\setmonofont[BoldFont={Inconsolata LGC Bold}]{Inconsolata LGC} %  ("typographic")
                                                               %  in verbatim blocks
\defaultfontfeatures{%                                         %  of Haskell code.
  Scale=MatchLowercase, % ... and here again                   %  Now the quote is
  Mapping=tex-text,                                            %  upright and safely
  SmallCapsFeatures={LetterSpace=2.5,WordSpace=1.05},          %  copy-pasteable to
}                                                              %  the REPL without
%--------------------------------------------------------------%  giving errors.

% To use Libertine letters and numbers,
% but tx-style operators in math environment:
\usepackage[libertine]{newtxmath}
\usepackage{amsmath}
% Needed to display additional math unicode symbols (like double-colon)

% https://github.com/wspr/unicode-math/issues/469
\expandafter\let\csname not=\endcsname\relax
\expandafter\let\csname not<\endcsname\relax
\expandafter\let\csname not>\endcsname\relax
\usepackage{unicode-math}
\setmathfont{Libertinus Math}

\usepackage[all]{nowidow}
\usepackage{emptypage}
\usepackage{noindentafter}

% So that file names with multiple dots don't confuse
% graphicx package when using \includegraphics command:
\usepackage[multidot]{grffile}
\usepackage{graphicx}
\usepackage{caption, wrapfig, framed, subfigure}
\usepackage[export]{adjustbox}
\captionsetup{labelformat=empty,font=scriptsize}
\usepackage{titlecaps}

\usepackage[usenames,dvipsnames,x11names]{xcolor}
\usepackage{longtable}
\usepackage{booktabs}
% Workaround to fix mismatched left and right math delimiters. Taken from:
% http://tex.stackexchange.com/questions/63410/parentheses-differ-xelatex-fontspec-newtxmath-libertine
\DeclareSymbolFont{parenthesis}{T1}{fxl}{m}{n}
\DeclareMathDelimiter{(}{\mathopen}{parenthesis}{"28}{largesymbols}{"00}
\DeclareMathDelimiter{)}{\mathclose}{parenthesis}{"29}{largesymbols}{"01}
\DeclareMathDelimiter{[}{\mathopen}{parenthesis}{"5B}{largesymbols}{"02}
\DeclareMathDelimiter{]}{\mathclose}{parenthesis}{"5D}{largesymbols}{"03}
\DeclareMathDelimiter{\lbrace}{\mathopen}{parenthesis}{"7B}{largesymbols}{"08}
\DeclareMathDelimiter{\rbrace}{\mathclose}{parenthesis}{"7D}{largesymbols}{"09}

% Use tikz-cd for commutative diagrams
\usepackage{tikz-cd}
\usepackage[framemethod=TikZ]{mdframed}

\usepackage{ifthen}
\usepackage{fancyvrb}
\fvset{fontsize=\small}

\usepackage{minted}
\setminted[text]{fontsize=\small,breaklines}
\usemintedstyle{github}

\usepackage{imakeidx}
\usepackage[totoc,font=footnotesize]{idxlayout}
\usepackage{fancyhdr}
\pagestyle{plain}
\usepackage[final]{pdfpages} % inserts pages from a pdf file

\usepackage{titlesec}  % to change the appearance of section titles
\usepackage{listings}  % for syntax highlighted code listings
\usepackage{enumerate} % allows customized labels in enumerations
\usepackage{enumitem}  % allows nested enumeration with numbers
\PassOptionsToPackage{hyphens}{url}\usepackage{hyperref}  % makes cross references and URLs clickable
\definecolor{LinkRed}{HTML}{80171F}
\hypersetup{
  pdfauthor={Bartosz Milewski},
  pdftitle={Category Theory for Programmers},
  pdfsubject={category theory, computer science, programming, abstraction, composition},
  colorlinks=true,
  linkcolor=LinkRed,
  urlcolor=LinkRed,
}
\usepackage{afterpage}
\newcommand\blankpage{%
    \null
    \thispagestyle{empty}%
    \addtocounter{page}{-1}%
    \newpage}

\usepackage{subfiles}
\makeatletter
\let\org@subfile\subfile
\renewcommand*{\subfile}[1]{%
  \filename@parse{#1}
  \expandafter
  \graphicspath\expandafter{\expandafter{\filename@area}}
  \org@subfile{#1}%
}
\makeatother

% Document colors
\definecolor{Dark}          {HTML} {262626}
\definecolor{DropCapGray}   {HTML} {B8B8B8}
\definecolor{ChapterGray}   {HTML} {C8C8C8}
\definecolor{ChapterViolet} {HTML} {AEAECE}
\definecolor{DropCapViolet} {HTML} {9090C0}

\usepackage{lettrine}  % adds commands that make drop capitals
\renewcommand{\LettrineFontHook}{\rmfamily\mdseries\color{DropCapViolet}}
\renewcommand{\DefaultLraise}{0.00}
\renewcommand{\DefaultLoversize}{0.02}
\renewcommand{\DefaultLhang}{0.12}
\setlength{\DefaultFindent}{1pt}
\setlength{\DefaultNindent}{0em}

% removes the "Part X" text from \part
\renewcommand{\partname}{}
\renewcommand{\thepart}{}

\usepackage{xparse}
\usepackage[abspath]{currfile}

% kotex setting
\usepackage{kotex}

\setmainhangulfont{Noto Sans CJK KR}
\setsanshangulfont{Noto Sans CJK KR}

\newenvironment{snip}[2][]
  {\VerbatimEnvironment
  \mdfsetup{
    linecolor=gray!20,
    linewidth=2pt,
    topline=false,
    bottomline=false,
    rightline=false
  }
  \begin{mdframed}\begin{minted}[#1]{#2}}
 {\end{minted}\end{mdframed}
 \vspace{-1ex}}

 \newenvironment{snipv}
 {\VerbatimEnvironment
 \mdfsetup{
   linecolor=gray!20,
   linewidth=2pt,
   topline=false,
   bottomline=false,
   rightline=false
 }
 \begin{mdframed}\begin{Verbatim}[commandchars=\\\{\}]}
{\end{Verbatim}\end{mdframed}
\vspace{-1ex}}

\NewDocumentCommand\src{mO{}}{
  \srcsnippet{\currfileabsdir/code/haskell/#1.hs}{blue}{haskell}{#2}
  \ifdefined\OPTCustomLanguage{%
    \unskip
    \srcsnippet{\currfileabsdir/code/\OPTCustomLanguage/#1.\OPTCustomLanguageExt}{\OPTCustomLanguageColor}{\OPTCustomLanguage}{#2}
  }
  \fi
  \NoIndentAfterThis
}
\NewDocumentCommand\srcsnippet{mmmm}{
  \newif\ifbreak
  \def\snippet{#1}
  \mdfsetup{%
    linecolor=#2!20,%
    linewidth=2pt,
    topline=false,
    bottomline=false,
    rightline=false,
  }
  \def\x{#4}
  \ifthenelse{\equal{\x}{b}}{\breaktrue}{\breakfalse}
  \begin{mdframed}
    \ifbreak \inputminted[autogobble,breaklines]{#3}{\snippet}
    \else \inputminted[autogobble]{#3}{\snippet}
    \fi
  \end{mdframed}
}

\newcommand{\acronym}[1]{\textsc{\fontspec[Numbers={OldStyle}]{Linux Libertine O}\MakeLowercase{#1}}}
\newcommand{\newterm}[1]{\index{#1}\emph{#1}}
\newcommand{\code}[1]{\Verb+{#1}+}
\newcommand{\heading}[1]{{\sffamily\bfseries #1}}
\newcommand{\mono}[1]{\hbox{\ttfamily\scriptsize #1}}
\newcommand{\monoit}[1]{\hbox{\ttfamily\itshape\scriptsize #1}}
\newcommand{\mathtext}[1]{\ensuremath{\pmb{#1}}}
\newcommand{\urlref}[2]{\href{#1}{#2}\urlfootnote{#1}}

% https://tex.stackexchange.com/questions/219445/line-break-in-texttt/219497
\renewcommand{\code}[1]{%
  \begingroup
  \ttfamily
  \begingroup\lccode`~=`/\lowercase{\endgroup\def~}{/\discretionary{}{}{}}%
  \begingroup\lccode`~=`[\lowercase{\endgroup\def~}{[\discretionary{}{}{}}%
  \begingroup\lccode`~=`.\lowercase{\endgroup\def~}{.\discretionary{}{}{}}%
  \catcode`/=\active\catcode`[=\active\catcode`.=\active
  \scantokens{#1\noexpand}%
  \endgroup
}

\makeatletter
\newcommand\urlfootnote@[1]{\footnote{\url@{#1}}}
\DeclareRobustCommand{\urlfootnote}{\hyper@normalise\urlfootnote@}
\makeatother

\titleformat{\chapter}[display]
  {\color{Dark}\normalfont\sffamily\bfseries\LARGE}
  {\filright \color{ChapterViolet}\sffamily\mdseries
    \fontsize{6em}{0em}\selectfont
    {\addfontfeature{Numbers=OldStyle}\thechapter}}
  {1em}
  {\filright}

\titleformat{\section}
{\color{Dark}\normalfont\Large\sffamily\bfseries}
{\color{DropCapViolet}\thesection}{0.8em}{}

\titleformat{\subsection}
{\color{Dark}\normalfont\large\sffamily\bfseries}
{\color{DropCapViolet}\thesubsection}{0.8em}{}

\titleformat{\subsubsection}
{\color{black}\normalfont\normalsize\sffamily\bfseries}
{\color{DropCapViolet}\thesubsubsection}{0.8em}{}

\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}

\sloppy
\frenchspacing
\makeindex

% reduce space between items in a list
\providecommand{\tightlist}{%
\setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

%====================%
%  End of preamble.  %
%====================%

\input{category}
\begin{document}
